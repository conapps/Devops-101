# S3

Amazon S3 es un servicio web que permite almacenar objetos con un nivel de disponibilidad muy alto. Es un servicio que tiene m√∫ltiples a√±os en el mercado y es utilizado por todo tipo de empresas para diversas aplicaciones: respaldos, hosting web, streaming, etc. 

Con los a√±os ha adquirido una gran variedad de funcionalidades que lo hacen muy versatil. Entre ellas:

- Encriptaci√≥n.
- Multiples niveles de disponibilidad.
- Ciclos de vida de archivos.
- Servidor Web.
- Etc.

As√≠ como con otros servicios, hay m√∫ltiples formas de interactuar con el pero por ahora nos concentraremos en usarlo desde la consola. 

Antes de empezar definiremos algunos recursos fundamentales para entender como funciona S3:

- `Buckets`: Funcionan como un `namespace` bajo el cual se almacenar√°n todos los objetos. Los `Buckets` son creados dentro de una regi√≥n pero pueden ser migrados a otra de ser necesario. El nombre de los `Buckets` tiene que ser √∫nico dentro de todas las regiones. AWS S3 utiliza un sistema de nombre plano para los buckets, similar al utilizado por `DNS`.
- `Objects`: Corresponden a los objetos que queremos almacenar dentro de S3. Puede ser cualquier tipo de archivo, de tama√±os ente 0 y 5TB. Los `Objects` son almacenados dentro de un `Bucket`, sin existir un l√≠mite en la cantidad de `Objects` almacenados dentro de uno. Cada `Object` cuenta con ciertas propiedades para identificarlo y protegerlo. El atributo m√°s importante de un `Object` es su `Key` o llave. La `Key` corresponde al nombre asignado al objeto, y es la direcci√≥n que debemos utilizar para recuperarlo.

S3 en el fondo funciona como una base de datos de tipo llave/valor con una capacidad cas√≠ infinita para almacenar objetos. Debido a este esquema es que S3 **no permite editar objetos, solo sustituirlos**. Tambi√©n soporta un sistema de versionado que permite mantener un historico del estado de cada `Object` de forma indefinida. 

> ‚ùó‚ùóÔ∏è‚ùóÔ∏è<br>
>  El versionado de objetos se debe realizar sobre todo un `Bucket` no puede realizarse por objeto.
> <br>‚ùó‚ùóÔ∏è‚ùóÔ∏è

---

## üíª DEMO #13 ~ Creaci√≥n de un `Bucket` de S3 <a name="demo013"></a>

El nombre de un `Bucket` cuenta con ciertas restricciones que tenemos que cumplir, adem√°s de ser √∫nico dentro de AWS:

- Debe cumplir con las convenciones de DNS.
- Debe tener entre 3 y 63 car√°cteres.
- No debe contener mayusculas o guiones-bajo `_`.
- Debe comenzar con una letra m√≠nuscula o un n√∫mero.
- Debe estar compuesto de m√∫ltiples etiquetas separadas por un punto `.`.
- Cada etiqueta debe comenzar y terminar con un a letra m√≠nuscula o un n√∫mero.
- No debe tener la forma de una direcci√≥n `IP` (ej. `192.168.1.1`).

Para este ejemplo utilizaremos la siguiente convenci√≥n:

`<apellido>-<nombre>-cloud-devops`

**No utilice tildes, y sustituya caracteres tipo `√±` ya que no ser√°n reconocidos.**

### Procedimiento

1. Ir al Dashboard de S3.
2. Hacer click en `Create bucket`.
3. Ingresar el nombre del `Bucket`.
4. Hacer click en `Next`.
5. Hacer click en `Next`.
6. Deseleccionar todas las opciones (4).
7. Hacer click en `Next`.
8. Hacer click en `Create Bucket`.

### FAQ

**¬øPorque en la barra de la consola aparece `Global` en vez de la reg√≠√≥n donde estaba trabajando?**

S3 es un servicio Global, por m√°s que los objetos est√©n almacenados en una regi√≥n puntual. Como es servido sobre Internet, puedo acceder a los objetos almacenados en S3 desde cualquier otra regi√≥n, sin necesidad de realizar ning√∫n tipo de configuraci√≥n adicional.

---

Haciendo click sobre el `Bucket` recientemente creado entramos a su consola de administraci√≥n. Dentro de las opciones que nos presenta vamos a ver una que dice `Create folder`. Sin embargo, el concepto de una `folder` en S3 no es el mismo al que estamos acostrumbrados.

Como se menciono antes, S3 tiene una estructura plana en donde todos los objetos est√°n almacenados dentro de un `Bucket`. Esta estructura puede ser dificil de manejar, sobretodo si tenemos una gran cantidad de objetos dentro del `Bucket`. Es por esto que S3 ofrece un sistema de jerarqu√≠a l√≥gico que utiliza prefijos y delimitadores en las `Keys` para simular el funcionamiento de carpetas y subdirectorios. 

Por ejemplo, si guardamos un objeto dentro de nuesto `Bucket` con la `Key` `devops/cloud/ejemplo.txt`, la consola utilizar√° como delimitador la `/` y creara "carpetas" llamadas `devops` y `cloud` en donde se encontrar√° el archivo `ejemplo.txt`. Si no le colocamos un prefijo a la `Key` de nuestro objeto, el mismo ser√° almacenado en la raiz del `Bucket`.

---

## üíª DEMO #14 ~ Creaci√≥n de un archivo dentro del `Bucket` <a name="demo014"></a>

Vamos a necesitar subir un archivo a `S3` para aprender como funciona. Pueden utilizar un archivo de su propiedad que ya este en su maquina o la siguiente imagen licenciada bajo la licencia `Creative Commons`.

![Photo by Jarylle Adriane Paloma on Unsplash](../imagenes/street.jpg)
Photo by Jarylle Adriane Paloma on Unsplash

### Procedimiento

1. Ir al Dashboard de S3.
2. Hacer click en el `Bucket` donde queremos subir un objeto.
3. Hacer click en `Upload`.
4. Arrastrar el archivo o seleccionarlo haciendo click en `Add files`. Se pueden subir m√°s de un archivo a la vez.
5. Hacer click en `Next`.
6. En la secci√≥n `Manage public permissions` seleccionar `Grant public read access to this object(s)`.
7. Hacer click en `Next`.
8. Seleccionar la clase de almacenamiento `Reduced Redundancy`.
9. Hacer click en `Next`.
10. Hacer click en `Upload`.

### FAQ

**¬øQue pasa si no configuro la opci√≥n para que sea p√∫blico?**

El acceso al archivo estar√° determinado por `IAM`, servicio encargado de manejar los permisos de acceso de la cuenta de AWS.

**¬øQue pasa si no selecciono la clase de almacenamiento `Reduced Redundancy`?**

Nada. Las clases de almacenamiento disponible cuentan con distintos niveles de SLA en cuestiones de robustez y disponibilidad. Adem√°s, cada clase de almacenamiento tiene un costo distinto y n√∫mero m√≠nimo de d√≠as de almacenamiento. La clase de almacenamiento puede modificarse en cualquier momento de todas maneras.

---

Cargamos los archivos en modo p√∫blico simplemente para poder ver√≠ficar que fueron cargados correctamente f√°cilmente.

Podemos acceder al objeto a trav√©s de su URL. Si siguio la convenci√≥n de `<apellido>-<nombre>-cloud-devops` para la creaci√≥n de su Bucket, y utilizo la imagen `street.jpg` como objeto de prueba, podr√° acceder a la misma a trav√©s de la siguiente URL:

```
https://<apellido>-<nombre>-cloud-devops.s3.amazonaws.com/street.jpg
```

> ‚ùó‚ùóÔ∏è‚ùóÔ∏è<br/>
>  Si hubiesemos utilizado `.` en vez de `-` dentro del nombre del bucket, S3 nos hubiera asignado una URL diferente para nuestros objetos. La misma tendr√≠a el siguiente formato: <br/>`https://s3.amazonaws.com/<apellido>.<nombre>.cloud.devops/street.jpg`
> <br/>‚ùó‚ùóÔ∏è‚ùóÔ∏è